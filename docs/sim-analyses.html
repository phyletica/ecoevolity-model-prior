
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Simulation-based analyses &#8212; Ecoevolity model prior experiments 0.1.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Working on project docs" href="working-on-docs.html" />
    <link rel="prev" title="Sampling the model priors" href="sample-priors.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Ecoevolity model prior experiments</a></h1>



<p class="blurb">Experimenting with new comparative phylogeographical models</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=phyletica&repo=ecoevolity-model-prior&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="prerequisites.html">Before starting</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="project-tour.html">Project Tour</a></li>
<li class="toctree-l1"><a class="reference internal" href="ecoevolity-configs.html">The ecoevolity configs</a></li>
<li class="toctree-l1"><a class="reference internal" href="sample-priors.html">Sampling the model priors</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Simulation-based analyses</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setup-our-environment">Setup our environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-simulation-scripts">Create simulation scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-simulation-scripts">Run simulation scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#analyzing-simulated-data">Analyzing simulated data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#summarizing-the-results">Summarizing the results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cleaning-up">Cleaning up</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reflection">Reflection</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="working-on-docs.html">Working on project docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgments.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">Citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="zbib/references.html">Literature Cited</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="sample-priors.html" title="previous chapter">Sampling the model priors</a></li>
      <li>Next: <a href="working-on-docs.html" title="next chapter">Working on project docs</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="simulation-based-analyses">
<span id="sim-analyses"></span><h1>Simulation-based analyses<a class="headerlink" href="#simulation-based-analyses" title="Permalink to this headline">¶</a></h1>
<p>As described in the
<a class="reference internal" href="background.html#background"><span class="std std-ref">Background</span></a> and <a class="reference internal" href="ecoevolity-configs.html#eco-configs"><span class="std std-ref">The ecoevolity configs</span></a> sections,
we will be simulating datasets under five different models on divergneces among
the 10 pairs of populations:</p>
<ol class="arabic simple">
<li>Dirichlet-process (DP) prior</li>
<li>Pitman-Yor process (PYP) prior</li>
<li>Uniform distribution with a split-weight parameter (SW)</li>
<li>Simultaneous divergence</li>
<li>Independent divergences</li>
</ol>
<p>The settings for these models are contained in three <a class="reference external" href="http://phyletica.org/ecoevolity">ecoevolity</a> configuration files
in the <code class="docutils literal notranslate"><span class="pre">ecoevolity-configs</span></code> directory of the project. These
are, respectively:</p>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">pairs-10-dpp-conc-2_0-2_71-time-1_0-0_05.yml</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">pairs-10-pyp-conc-2_0-1_79-disc-1_0-4_0-time-1_0-0_05.yml</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">pairs-10-unif-sw-0_55-7_32-time-1_0-0_05.yml</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">fixed-pairs-10-simultaneous-time-1_0-0_05.yml</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">fixed-pairs-10-independent-time-1_0-0_05.yml</span></code></li>
</ol>
<p>We will use <code class="docutils literal notranslate"><span class="pre">simcoevolity</span></code> to simulate these datasets in a format ready to
analyze with <code class="docutils literal notranslate"><span class="pre">ecoevolity</span></code>.
We will generate scripts in the <code class="docutils literal notranslate"><span class="pre">scripts/simcoevolity-scripts</span></code> directory that
will run these simulations in batches of manageable numbers of replicates.</p>
<div class="section" id="setup-our-environment">
<h2>Setup our environment<a class="headerlink" href="#setup-our-environment" title="Permalink to this headline">¶</a></h2>
<p>Before anything else, navigate to the project directory (if you are not already
there):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">your</span><span class="o">/</span><span class="n">copy</span><span class="o">/</span><span class="n">of</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">prior</span>
</pre></div>
</div>
<p>If you are working on AU’s Hopper cluster, this will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="n">YOUR</span><span class="o">-</span><span class="n">AU</span><span class="o">-</span><span class="n">USERNAME</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">prior</span>
</pre></div>
</div>
<p>If you haven’t already, let’s activate the Python environment for this project:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">activate</span> <span class="n">ecoevolity</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">prior</span><span class="o">-</span><span class="n">project</span>
</pre></div>
</div>
</div>
<div class="section" id="create-simulation-scripts">
<h2>Create simulation scripts<a class="headerlink" href="#create-simulation-scripts" title="Permalink to this headline">¶</a></h2>
<p>Now, lets <code class="docutils literal notranslate"><span class="pre">cd</span></code> into the project’s <code class="docutils literal notranslate"><span class="pre">scripts</span></code> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">scripts</span>
</pre></div>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">create_new_batch_of_simcoevolity-scripts.py</span></code> Python script to create
simcoevolity scripts for generating a new batch of 10 simulated datasets for
each of the 5 models (ecoevolity config files):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">create_new_batch_of_simcoevolity</span><span class="o">-</span><span class="n">scripts</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">n</span> <span class="mi">10</span> <span class="n">simcoevolity</span><span class="o">-</span><span class="n">scripts</span><span class="o">/</span><span class="n">template</span><span class="o">-</span><span class="n">simcoevolity</span><span class="o">-*</span>
</pre></div>
</div>
<p>The output should confirm the creation of 5 new scripts for running
<code class="docutils literal notranslate"><span class="pre">simcoevolity</span></code> (one for each config in <code class="docutils literal notranslate"><span class="pre">ecoevolity-configs</span></code>), and report a
batch ID:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Script</span> <span class="n">written</span> <span class="n">to</span> <span class="s1">&#39;simcoevolity-scripts/simcoevolity-fixed-pairs-10-independent-time-1_0-0_05-batch-308303035.sh&#39;</span>
<span class="n">Script</span> <span class="n">written</span> <span class="n">to</span> <span class="s1">&#39;simcoevolity-scripts/simcoevolity-fixed-pairs-10-simultaneous-time-1_0-0_05-batch-308303035.sh&#39;</span>
<span class="n">Script</span> <span class="n">written</span> <span class="n">to</span> <span class="s1">&#39;simcoevolity-scripts/simcoevolity-pairs-10-dpp-conc-2_0-2_71-time-1_0-0_05-batch-308303035.sh&#39;</span>
<span class="n">Script</span> <span class="n">written</span> <span class="n">to</span> <span class="s1">&#39;simcoevolity-scripts/simcoevolity-pairs-10-pyp-conc-2_0-1_79-disc-1_0-4_0-time-1_0-0_05-batch-308303035.sh&#39;</span>
<span class="n">Script</span> <span class="n">written</span> <span class="n">to</span> <span class="s1">&#39;simcoevolity-scripts/simcoevolity-pairs-10-unif-sw-0_55-7_32-time-1_0-0_05-batch-308303035.sh&#39;</span>

<span class="n">Simcoevolity</span> <span class="n">scripts</span> <span class="n">successfully</span> <span class="n">written</span><span class="o">.</span>

<span class="n">Batch</span> <span class="n">ID</span><span class="p">:</span>
    <span class="mi">308303035</span>
</pre></div>
</div>
<p>But, your batch ID number should be different.</p>
<p><strong>IMPORTANT: Make a note of your batch ID number, you will need it moving forward.</strong>
For all of the commands below, use your batch ID number in place of
<code class="docutils literal notranslate"><span class="pre">308303035</span></code>.</p>
<div class="section" id="commit-simulation-scripts">
<h3>Commit simulation scripts<a class="headerlink" href="#commit-simulation-scripts" title="Permalink to this headline">¶</a></h3>
<p>Before we run the <code class="docutils literal notranslate"><span class="pre">simcoevolity</span></code> scripts, let’s add them to the staging area
of project Git repository:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">add</span> <span class="n">simcoevolity</span><span class="o">-</span><span class="n">scripts</span><span class="o">/*</span><span class="mf">308303035.</span><span class="n">sh</span>
</pre></div>
</div>
<p>Then, commit them to the repository:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">commit</span>
</pre></div>
</div>
<p>A good commit message might look something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Adding</span> <span class="n">batch</span> <span class="mi">308303035</span> <span class="n">of</span> <span class="n">simcoevolity</span> <span class="n">scripts</span><span class="o">.</span>

<span class="n">Adding</span> <span class="n">shell</span> <span class="n">scripts</span> <span class="n">generated</span> <span class="n">by</span><span class="p">:</span>

    <span class="n">create_new_batch_of_simcoevolity</span><span class="o">-</span><span class="n">scripts</span><span class="o">.</span><span class="n">py</span>

<span class="n">These</span> <span class="n">scripts</span> <span class="n">will</span> <span class="n">run</span> <span class="n">simcoevolity</span> <span class="n">to</span> <span class="n">generate</span> <span class="n">a</span> <span class="n">batch</span> <span class="n">of</span> <span class="mi">10</span>
<span class="n">simulated</span> <span class="n">datasets</span><span class="o">.</span>
</pre></div>
</div>
<p>Lastly, push the new scripts to the remote repository hosted on a <a class="reference external" href="https://github.com/">GitHub</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">push</span> <span class="n">origin</span> <span class="n">master</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="run-simulation-scripts">
<h2>Run simulation scripts<a class="headerlink" href="#run-simulation-scripts" title="Permalink to this headline">¶</a></h2>
<p>Next, <code class="docutils literal notranslate"><span class="pre">cd</span></code> into the <code class="docutils literal notranslate"><span class="pre">simcoevolity-scripts</span></code> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">simcoevolity</span><span class="o">-</span><span class="n">scripts</span>
</pre></div>
</div>
<p>If you are working on AU’s Hopper cluster, use a for loop to submit the five
<code class="docutils literal notranslate"><span class="pre">simcoevolity</span></code> scripts to the queue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">script_path</span> <span class="ow">in</span> <span class="o">*</span><span class="mf">308303035.</span><span class="n">sh</span><span class="p">;</span> <span class="n">do</span> <span class="o">../../</span><span class="nb">bin</span><span class="o">/</span><span class="n">psub</span> <span class="s2">&quot;$script_path&quot;</span><span class="p">;</span> <span class="n">done</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you are working on a different cluster, you will need
to either update the <code class="docutils literal notranslate"><span class="pre">../../bin/psub</span></code> to work for your system,
or replace <code class="docutils literal notranslate"><span class="pre">../../bin/psub</span></code> with whatever command is used on your
cluster to submit jobs.</p>
<p>If you are not on a cluster, you can simpy run the scripts directly:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">script_path</span> <span class="ow">in</span> <span class="o">*</span><span class="mf">308303035.</span><span class="n">sh</span><span class="p">;</span> <span class="n">do</span> <span class="n">bash</span> <span class="s2">&quot;$script_path&quot;</span><span class="p">;</span> <span class="n">done</span>
</pre></div>
</div>
</div>
<p>After submitting the scripts with the for loop, go ahead and <code class="docutils literal notranslate"><span class="pre">cd</span></code> out of the
<code class="docutils literal notranslate"><span class="pre">simcoevolity-scripts</span></code> directory, which will put you back up in the
<code class="docutils literal notranslate"><span class="pre">scripts</span></code> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">..</span>
</pre></div>
</div>
<p>Assuming you are on the Hopper cluster, you can monitor the progress of
the jobs by using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qstat</span>
</pre></div>
</div>
<p>When the jobs are waiting in queue to start, the output will look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Job</span> <span class="n">ID</span>                    <span class="n">Name</span>             <span class="n">User</span>            <span class="n">Time</span> <span class="n">Use</span> <span class="n">S</span> <span class="n">Queue</span>
<span class="o">-------------------------</span> <span class="o">----------------</span> <span class="o">---------------</span> <span class="o">--------</span> <span class="o">-</span> <span class="o">-----</span>
<span class="mf">1942030.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>         <span class="o">...-</span><span class="mf">308303035.</span><span class="n">sh</span> <span class="n">jro0014</span>                <span class="mi">0</span> <span class="n">Q</span> <span class="n">general</span>
<span class="mf">1942031.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>         <span class="o">...-</span><span class="mf">308303035.</span><span class="n">sh</span> <span class="n">jro0014</span>                <span class="mi">0</span> <span class="n">Q</span> <span class="n">general</span>
<span class="mf">1942032.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>         <span class="o">...-</span><span class="mf">308303035.</span><span class="n">sh</span> <span class="n">jro0014</span>                <span class="mi">0</span> <span class="n">Q</span> <span class="n">general</span>
<span class="mf">1942033.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>         <span class="o">...-</span><span class="mf">308303035.</span><span class="n">sh</span> <span class="n">jro0014</span>                <span class="mi">0</span> <span class="n">Q</span> <span class="n">general</span>
<span class="mf">1942034.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>         <span class="o">...-</span><span class="mf">308303035.</span><span class="n">sh</span> <span class="n">jro0014</span>                <span class="mi">0</span> <span class="n">Q</span> <span class="n">general</span>
</pre></div>
</div>
<p>When the jobs are running, the output will look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Job</span> <span class="n">ID</span>                    <span class="n">Name</span>             <span class="n">User</span>            <span class="n">Time</span> <span class="n">Use</span> <span class="n">S</span> <span class="n">Queue</span>
<span class="o">-------------------------</span> <span class="o">----------------</span> <span class="o">---------------</span> <span class="o">--------</span> <span class="o">-</span> <span class="o">-----</span>
<span class="mf">1942030.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>         <span class="o">...-</span><span class="mf">308303035.</span><span class="n">sh</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">19</span> <span class="n">R</span> <span class="n">general</span>
<span class="mf">1942031.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>         <span class="o">...-</span><span class="mf">308303035.</span><span class="n">sh</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">19</span> <span class="n">R</span> <span class="n">general</span>
<span class="mf">1942032.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>         <span class="o">...-</span><span class="mf">308303035.</span><span class="n">sh</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">19</span> <span class="n">R</span> <span class="n">general</span>
<span class="mf">1942033.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>         <span class="o">...-</span><span class="mf">308303035.</span><span class="n">sh</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">19</span> <span class="n">R</span> <span class="n">general</span>
<span class="mf">1942034.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>         <span class="o">...-</span><span class="mf">308303035.</span><span class="n">sh</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">19</span> <span class="n">R</span> <span class="n">general</span>
</pre></div>
</div>
<p>When the jobs are complete, the output will <em>briefly</em> look like (after a few
minutes of being complete, the jobs will disappear from the output of
<code class="docutils literal notranslate"><span class="pre">qstat</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Job</span> <span class="n">ID</span>                    <span class="n">Name</span>             <span class="n">User</span>            <span class="n">Time</span> <span class="n">Use</span> <span class="n">S</span> <span class="n">Queue</span>
<span class="o">-------------------------</span> <span class="o">----------------</span> <span class="o">---------------</span> <span class="o">--------</span> <span class="o">-</span> <span class="o">-----</span>
<span class="mf">1942030.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>         <span class="o">...-</span><span class="mf">308303035.</span><span class="n">sh</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">43</span> <span class="n">C</span> <span class="n">general</span>
<span class="mf">1942031.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>         <span class="o">...-</span><span class="mf">308303035.</span><span class="n">sh</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">42</span> <span class="n">C</span> <span class="n">general</span>
<span class="mf">1942032.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>         <span class="o">...-</span><span class="mf">308303035.</span><span class="n">sh</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">23</span> <span class="n">C</span> <span class="n">general</span>
<span class="mf">1942033.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>         <span class="o">...-</span><span class="mf">308303035.</span><span class="n">sh</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">24</span> <span class="n">C</span> <span class="n">general</span>
<span class="mf">1942034.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>         <span class="o">...-</span><span class="mf">308303035.</span><span class="n">sh</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">23</span> <span class="n">C</span> <span class="n">general</span>
</pre></div>
</div>
<p>What each of these <code class="docutils literal notranslate"><span class="pre">simcoevolity</span></code> scripts does is:</p>
<ol class="arabic simple">
<li>Use the <code class="docutils literal notranslate"><span class="pre">simcoevolity</span></code> tool to simulate datasets and output them into a
<code class="docutils literal notranslate"><span class="pre">ecoevolity-simulations</span></code> directory in the project directory.</li>
<li>Create YAML-formatted config files for analyzing each dataset with <code class="docutils literal notranslate"><span class="pre">ecoevolity.</span></code>
For each dataset, 6 config files are created. One for each of the three
models we wish to compare for the project (the DP, PYP, and SW models
defined in the config file in the <code class="docutils literal notranslate"><span class="pre">ecoevolity-configs</span></code> directory).
And another config for each of these three models, but configured to ignore
constant characters (i.e., only use characters that vary among the samples
genomes sampled from the two populations).</li>
<li>For each config file created in Step 2 above, the script generates 4 Bash
scripts for analyzing the respective dataset 4 times with <code class="docutils literal notranslate"><span class="pre">ecoevolity</span></code>
(i.e., four independent MCMC chains for each analysis).
Thus, for each dataset simulated by <code class="docutils literal notranslate"><span class="pre">simcoevolity</span></code> there are 6 config
files and 24 Bash scripts for running <code class="docutils literal notranslate"><span class="pre">ecoevolity</span></code> analyses.</li>
</ol>
<p>All of the files created during these 3 steps are output into
a <code class="docutils literal notranslate"><span class="pre">ecoevolity-simulations</span></code> directory in the project directory.
If you are still in the <code class="docutils literal notranslate"><span class="pre">scripts</span></code> directory, you can list the contents of
this directory using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ls</span> <span class="o">../</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span>
</pre></div>
</div>
<p>This should show 5 directories, one for each config file in <code class="docutils literal notranslate"><span class="pre">ecoevolity-configs</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fixed</span><span class="o">-</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">independent</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span>
<span class="n">fixed</span><span class="o">-</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">simultaneous</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span>
<span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">dpp</span><span class="o">-</span><span class="n">conc</span><span class="o">-</span><span class="mi">2_0</span><span class="o">-</span><span class="mi">2_71</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span>
<span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">pyp</span><span class="o">-</span><span class="n">conc</span><span class="o">-</span><span class="mi">2_0</span><span class="o">-</span><span class="mi">1_79</span><span class="o">-</span><span class="n">disc</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">4_0</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span>
<span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">unif</span><span class="o">-</span><span class="n">sw</span><span class="o">-</span><span class="mi">0_55</span><span class="o">-</span><span class="mi">7_32</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span>
</pre></div>
</div>
<p>Let’s look into the first one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ls</span> <span class="o">../</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/</span><span class="n">fixed</span><span class="o">-</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">independent</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span>
</pre></div>
</div>
<p>You should see a directory associated with <em>your</em> batch number (your number
will be different from mine):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span>
</pre></div>
</div>
<p>If you look in this directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ls</span> <span class="o">../</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/</span><span class="n">fixed</span><span class="o">-</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">independent</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span>
</pre></div>
</div>
<p>You will see a very long list of files, so I won’t show the output here.
For each <code class="docutils literal notranslate"><span class="pre">simcoevolity</span></code> simulation replicate there are:</p>
<ul class="simple">
<li>10 data files (one for each of the pairs of populations). The names of
these files end with “<code class="docutils literal notranslate"><span class="pre">chars.txt</span></code>”.</li>
<li>1 file containing the true values of all the parameters that
<code class="docutils literal notranslate"><span class="pre">simcoevolity</span></code> used to simulate the data files. These files end with
“<code class="docutils literal notranslate"><span class="pre">-true-values.txt</span></code>”.</li>
<li>6 ecoevolity config files. Two each for the DP, PYP, and SW models.
Two each, because we will run analyses for each model both using and
ignoring constant characters in the simulated data files.
These files end with “<code class="docutils literal notranslate"><span class="pre">-config.yml</span></code>”</li>
<li>24 Bash scripts for analyzing the dataset with <code class="docutils literal notranslate"><span class="pre">ecoevolity</span></code>.
Four independent analyses (MCMC chains) for each of the 6 config files.
These files end with “<code class="docutils literal notranslate"><span class="pre">-qsub.sh</span></code>”</li>
</ul>
</div>
<div class="section" id="analyzing-simulated-data">
<h2>Analyzing simulated data<a class="headerlink" href="#analyzing-simulated-data" title="Permalink to this headline">¶</a></h2>
<p>Next, we need to run all those Bash scripts to analyze each simulation
replicate with <code class="docutils literal notranslate"><span class="pre">ecoevolity</span></code> four times under 6 different configurations.
Given that we simulated 10 datasets under 5 different models, this
will be <img class="math" src="_images/math/81a03f99de88ddb62e01e5b7bd277aafe7e6fe35.svg" alt="24 \times 10 \times 5 = 1200"/> <code class="docutils literal notranslate"><span class="pre">ecoevolity</span></code> analyses.</p>
<p>If you are on the Hopper cluster, we will use a script that will run all of
these analyses as a single job array.
Hopper imposes a limit of 500 jobs per user, so we will use the job array to
run only 400 of these analyses at a time, and cycle through them until they are
all done.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you are <strong>not</strong> on the Hopper cluster, the <code class="docutils literal notranslate"><span class="pre">submit_sim_analyses.sh</span></code>
script we use below will not work on your system.
You will either need to update that script to work with your system,
or simply submit all theses analyses “manually.”
This can be done easily with a for loop. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">script_path</span> <span class="ow">in</span> <span class="o">../</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/*/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span><span class="o">/*</span><span class="n">qsub</span><span class="o">.</span><span class="n">sh</span><span class="p">;</span> <span class="n">do</span> <span class="n">echo</span> <span class="s2">&quot;$script_path&quot;</span><span class="p">;</span> <span class="n">done</span>
</pre></div>
</div>
<p class="last">Just change “echo” to whatever command is necessary to submit jobs on your
system (and remember your batch ID number is different).</p>
</div>
<p>To do this, make sure you are in the <code class="docutils literal notranslate"><span class="pre">scripts</span></code> directory of the project and
enter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="n">submit_sim_analyses</span><span class="o">.</span><span class="n">sh</span> <span class="o">../</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/*/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span>
</pre></div>
</div>
<p>This will produce a lot of output similar to (but with many more lines in place
of the ellipses):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Beginning</span> <span class="n">to</span> <span class="n">vet</span> <span class="ow">and</span> <span class="n">consolidate</span> <span class="n">sim</span> <span class="n">analysis</span> <span class="n">files</span> <span class="ow">in</span><span class="p">:</span>
  <span class="s1">&#39;../ecoevolity-simulations/fixed-pairs-10-independent-time-1_0-0_05/batch-308303035&#39;</span>
<span class="n">No</span> <span class="n">stdout</span><span class="p">:</span> <span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="n">jro0014</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">prior</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/</span><span class="n">fixed</span><span class="o">-</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">independent</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span><span class="o">/</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">dpp</span><span class="o">-</span><span class="n">conc</span><span class="o">-</span><span class="mi">2_0</span><span class="o">-</span><span class="mi">2_71</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">-</span><span class="n">sim</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">qsub</span><span class="o">.</span><span class="n">sh</span>
<span class="n">No</span> <span class="n">stdout</span><span class="p">:</span> <span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="n">jro0014</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">prior</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/</span><span class="n">fixed</span><span class="o">-</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">independent</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span><span class="o">/</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">dpp</span><span class="o">-</span><span class="n">conc</span><span class="o">-</span><span class="mi">2_0</span><span class="o">-</span><span class="mi">2_71</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">-</span><span class="n">sim</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">qsub</span><span class="o">.</span><span class="n">sh</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="n">Beginning</span> <span class="n">to</span> <span class="n">vet</span> <span class="ow">and</span> <span class="n">consolidate</span> <span class="n">sim</span> <span class="n">analysis</span> <span class="n">files</span> <span class="ow">in</span><span class="p">:</span>
  <span class="s1">&#39;../ecoevolity-simulations/fixed-pairs-10-simultaneous-time-1_0-0_05/batch-308303035&#39;</span>
<span class="n">No</span> <span class="n">stdout</span><span class="p">:</span> <span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="n">jro0014</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">prior</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/</span><span class="n">fixed</span><span class="o">-</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">simultaneous</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span><span class="o">/</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">dpp</span><span class="o">-</span><span class="n">conc</span><span class="o">-</span><span class="mi">2_0</span><span class="o">-</span><span class="mi">2_71</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">-</span><span class="n">sim</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">qsub</span><span class="o">.</span><span class="n">sh</span>
<span class="n">No</span> <span class="n">stdout</span><span class="p">:</span> <span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="n">jro0014</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">prior</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/</span><span class="n">fixed</span><span class="o">-</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">simultaneous</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span><span class="o">/</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">dpp</span><span class="o">-</span><span class="n">conc</span><span class="o">-</span><span class="mi">2_0</span><span class="o">-</span><span class="mi">2_71</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">-</span><span class="n">sim</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">qsub</span><span class="o">.</span><span class="n">sh</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="n">Beginning</span> <span class="n">to</span> <span class="n">vet</span> <span class="ow">and</span> <span class="n">consolidate</span> <span class="n">sim</span> <span class="n">analysis</span> <span class="n">files</span> <span class="ow">in</span><span class="p">:</span>
  <span class="s1">&#39;../ecoevolity-simulations/pairs-10-dpp-conc-2_0-2_71-time-1_0-0_05/batch-308303035&#39;</span>
<span class="n">No</span> <span class="n">stdout</span><span class="p">:</span> <span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="n">jro0014</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">prior</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">dpp</span><span class="o">-</span><span class="n">conc</span><span class="o">-</span><span class="mi">2_0</span><span class="o">-</span><span class="mi">2_71</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span><span class="o">/</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">dpp</span><span class="o">-</span><span class="n">conc</span><span class="o">-</span><span class="mi">2_0</span><span class="o">-</span><span class="mi">2_71</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">-</span><span class="n">sim</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">qsub</span><span class="o">.</span><span class="n">sh</span>
<span class="n">No</span> <span class="n">stdout</span><span class="p">:</span> <span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="n">jro0014</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">prior</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">dpp</span><span class="o">-</span><span class="n">conc</span><span class="o">-</span><span class="mi">2_0</span><span class="o">-</span><span class="mi">2_71</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span><span class="o">/</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">dpp</span><span class="o">-</span><span class="n">conc</span><span class="o">-</span><span class="mi">2_0</span><span class="o">-</span><span class="mi">2_71</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">-</span><span class="n">sim</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">qsub</span><span class="o">.</span><span class="n">sh</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="n">Beginning</span> <span class="n">to</span> <span class="n">vet</span> <span class="ow">and</span> <span class="n">consolidate</span> <span class="n">sim</span> <span class="n">analysis</span> <span class="n">files</span> <span class="ow">in</span><span class="p">:</span>
  <span class="s1">&#39;../ecoevolity-simulations/pairs-10-pyp-conc-2_0-1_79-disc-1_0-4_0-time-1_0-0_05/batch-308303035&#39;</span>
<span class="n">No</span> <span class="n">stdout</span><span class="p">:</span> <span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="n">jro0014</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">prior</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">pyp</span><span class="o">-</span><span class="n">conc</span><span class="o">-</span><span class="mi">2_0</span><span class="o">-</span><span class="mi">1_79</span><span class="o">-</span><span class="n">disc</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">4_0</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span><span class="o">/</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">dpp</span><span class="o">-</span><span class="n">conc</span><span class="o">-</span><span class="mi">2_0</span><span class="o">-</span><span class="mi">2_71</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">-</span><span class="n">sim</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">qsub</span><span class="o">.</span><span class="n">sh</span>
<span class="n">No</span> <span class="n">stdout</span><span class="p">:</span> <span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="n">jro0014</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">prior</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">pyp</span><span class="o">-</span><span class="n">conc</span><span class="o">-</span><span class="mi">2_0</span><span class="o">-</span><span class="mi">1_79</span><span class="o">-</span><span class="n">disc</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">4_0</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span><span class="o">/</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">dpp</span><span class="o">-</span><span class="n">conc</span><span class="o">-</span><span class="mi">2_0</span><span class="o">-</span><span class="mi">2_71</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">-</span><span class="n">sim</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">qsub</span><span class="o">.</span><span class="n">sh</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="n">Beginning</span> <span class="n">to</span> <span class="n">vet</span> <span class="ow">and</span> <span class="n">consolidate</span> <span class="n">sim</span> <span class="n">analysis</span> <span class="n">files</span> <span class="ow">in</span><span class="p">:</span>
  <span class="s1">&#39;../ecoevolity-simulations/pairs-10-unif-sw-0_55-7_32-time-1_0-0_05/batch-308303035&#39;</span>
<span class="n">No</span> <span class="n">stdout</span><span class="p">:</span> <span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="n">jro0014</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">prior</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">unif</span><span class="o">-</span><span class="n">sw</span><span class="o">-</span><span class="mi">0_55</span><span class="o">-</span><span class="mi">7_32</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span><span class="o">/</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">dpp</span><span class="o">-</span><span class="n">conc</span><span class="o">-</span><span class="mi">2_0</span><span class="o">-</span><span class="mi">2_71</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">-</span><span class="n">sim</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">qsub</span><span class="o">.</span><span class="n">sh</span>
<span class="n">No</span> <span class="n">stdout</span><span class="p">:</span> <span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="n">jro0014</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">prior</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">unif</span><span class="o">-</span><span class="n">sw</span><span class="o">-</span><span class="mi">0_55</span><span class="o">-</span><span class="mi">7_32</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span><span class="o">/</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">dpp</span><span class="o">-</span><span class="n">conc</span><span class="o">-</span><span class="mi">2_0</span><span class="o">-</span><span class="mi">2_71</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">-</span><span class="n">sim</span><span class="o">-</span><span class="mi">00</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">qsub</span><span class="o">.</span><span class="n">sh</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="n">Submitting</span> <span class="n">analyses</span> <span class="n">to</span> <span class="n">queue</span><span class="o">...</span>
<span class="o">../</span><span class="nb">bin</span><span class="o">/</span><span class="n">psub</span> <span class="o">-</span><span class="n">t</span> <span class="mi">00</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="n">a</span> <span class="mi">1</span><span class="o">-</span><span class="mi">1200</span><span class="o">%</span><span class="mi">400</span> <span class="o">../</span><span class="nb">bin</span><span class="o">/</span><span class="n">spawn_job_array</span> <span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="n">jro0014</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">prior</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">spawn_job_array</span><span class="o">.</span><span class="mi">2</span><span class="n">JjV3idzUInN</span>
<span class="n">qsub</span> <span class="o">-</span><span class="n">q</span> <span class="n">general</span> <span class="o">-</span><span class="n">j</span> <span class="n">oe</span> <span class="o">-</span><span class="n">l</span> <span class="n">nodes</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">ppn</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">walltime</span><span class="o">=</span><span class="mi">00</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="n">t</span> <span class="mi">1</span><span class="o">-</span><span class="mi">1200</span><span class="o">%</span><span class="mi">400</span> <span class="o">../</span><span class="nb">bin</span><span class="o">/</span><span class="n">spawn_job_array</span> <span class="o">-</span><span class="n">F</span>  <span class="s2">&quot;/scratch/jro0014/ecoevolity-model-prior/scripts/spawn_job_array.2JjV3idzUInN&quot;</span>
<span class="mi">1942324</span><span class="p">[]</span><span class="o">.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>
</pre></div>
</div>
<p>Why all the output complaining about “<code class="docutils literal notranslate"><span class="pre">No</span> <span class="pre">stdout</span></code>”?
Well, this script first looks for the results of all the analyses, and only
runs the analyses for the scripts that lack complete results (all of them in
our case, since we are running them for the first time).
This allows us to re-run this script after all the analyses are finished, and
it will re-run any analyses that failed
(Hopper has a depressingly high rate of job failures).</p>
<p>On hopper you can monitor the job array using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qstat</span>
</pre></div>
</div>
<p>which shows the status of the entire job array on one line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Job</span> <span class="n">ID</span>                    <span class="n">Name</span>             <span class="n">User</span>            <span class="n">Time</span> <span class="n">Use</span> <span class="n">S</span> <span class="n">Queue</span>
<span class="o">-------------------------</span> <span class="o">----------------</span> <span class="o">---------------</span> <span class="o">--------</span> <span class="o">-</span> <span class="o">-----</span>
<span class="mi">1942324</span><span class="p">[]</span><span class="o">.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>       <span class="n">spawn_job_array</span>  <span class="n">jro0014</span>                <span class="mi">0</span> <span class="n">R</span> <span class="n">general</span>
</pre></div>
</div>
<p>To see the individuals jobs within the array, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qstat</span> <span class="o">-</span><span class="n">t</span>
</pre></div>
</div>
<p>which will show the full list of jobs in the array that are running or waiting
to run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Job</span> <span class="n">ID</span>                    <span class="n">Name</span>             <span class="n">User</span>            <span class="n">Time</span> <span class="n">Use</span> <span class="n">S</span> <span class="n">Queue</span>
<span class="o">-------------------------</span> <span class="o">----------------</span> <span class="o">---------------</span> <span class="o">--------</span> <span class="o">-</span> <span class="o">-----</span>
<span class="mi">1942324</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>      <span class="o">...</span><span class="n">n_job_array</span><span class="o">-</span><span class="mi">1</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">53</span> <span class="n">R</span> <span class="n">general</span>
<span class="mi">1942324</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>      <span class="o">...</span><span class="n">n_job_array</span><span class="o">-</span><span class="mi">2</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">53</span> <span class="n">R</span> <span class="n">general</span>
<span class="mi">1942324</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>      <span class="o">...</span><span class="n">n_job_array</span><span class="o">-</span><span class="mi">3</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">52</span> <span class="n">R</span> <span class="n">general</span>
<span class="mi">1942324</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>      <span class="o">...</span><span class="n">n_job_array</span><span class="o">-</span><span class="mi">4</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">52</span> <span class="n">R</span> <span class="n">general</span>
<span class="mi">1942324</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>      <span class="o">...</span><span class="n">n_job_array</span><span class="o">-</span><span class="mi">5</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">29</span> <span class="n">R</span> <span class="n">general</span>
<span class="mi">1942324</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>      <span class="o">...</span><span class="n">n_job_array</span><span class="o">-</span><span class="mi">6</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">29</span> <span class="n">R</span> <span class="n">general</span>
<span class="mi">1942324</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>      <span class="o">...</span><span class="n">n_job_array</span><span class="o">-</span><span class="mi">7</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">28</span> <span class="n">R</span> <span class="n">general</span>
<span class="mi">1942324</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>      <span class="o">...</span><span class="n">n_job_array</span><span class="o">-</span><span class="mi">8</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">28</span> <span class="n">R</span> <span class="n">general</span>
<span class="mi">1942324</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>      <span class="o">...</span><span class="n">n_job_array</span><span class="o">-</span><span class="mi">9</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">27</span> <span class="n">R</span> <span class="n">general</span>
<span class="mi">1942324</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>     <span class="o">...</span><span class="n">_job_array</span><span class="o">-</span><span class="mi">10</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">12</span> <span class="n">R</span> <span class="n">general</span>
<span class="mi">1942324</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>     <span class="o">...</span><span class="n">_job_array</span><span class="o">-</span><span class="mi">11</span> <span class="n">jro0014</span>         <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">13</span> <span class="n">R</span> <span class="n">general</span>
<span class="o">...</span>
</pre></div>
</div>
<p>This list will be longer than 400 jobs, but the job array will make sure at
most 400 run at any given time.
It will also be shorter than the total number of jobs in the array (1200),
because the array will keep adding them into the wait list as it cycles through
all the analyses.</p>
<p>If you just want to know how many jobs are actively running, you can
pipe the output of <code class="docutils literal notranslate"><span class="pre">qstat</span> <span class="pre">-t</span></code> to <code class="docutils literal notranslate"><span class="pre">grep</span></code> and then to <code class="docutils literal notranslate"><span class="pre">wc</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qstat</span> <span class="o">-</span><span class="n">t</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&quot;R gen&quot;</span> <span class="o">|</span> <span class="n">wc</span> <span class="o">-</span><span class="n">l</span>
</pre></div>
</div>
<p>My output was:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">239</span>
</pre></div>
</div>
<p>So, 239 of my analyses are currently running.
You can change this to get the number of jobs the array
currently has waiting to run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qstat</span> <span class="o">-</span><span class="n">t</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&quot;Q gen&quot;</span> <span class="o">|</span> <span class="n">wc</span> <span class="o">-</span><span class="n">l</span>
</pre></div>
</div>
<p>If the job array is still adding unlisted jobs to the wait list, this number is
usually around 300.
If it’s less, this probably means the array is “out of” jobs (they are all
running or waiting to run).</p>
<p>The job array will create a lot of output files in your <code class="docutils literal notranslate"><span class="pre">scripts</span></code> directory.
If all is working well, you can get rid of these using the following command
from within the <code class="docutils literal notranslate"><span class="pre">scripts</span></code> directory of the project:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="n">spawn_job_array</span><span class="o">.*</span>
</pre></div>
</div>
<p>If all is <em>not</em> going well, these output files might have content to help
you figure out what the problem is.</p>
<p>Once the <code class="docutils literal notranslate"><span class="pre">qstat</span> <span class="pre">-t</span></code> command is showing that all of your analyses have finished,
run the same command from within your <code class="docutils literal notranslate"><span class="pre">scripts</span></code> directory again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="n">submit_sim_analyses</span><span class="o">.</span><span class="n">sh</span> <span class="o">../</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/*/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only re-run this command <em>after</em> all the analyses started
by this command the first time are no longer running.
In other words, the <code class="docutils literal notranslate"><span class="pre">qstat</span> <span class="pre">-t</span></code> should produce no output (assuming you are
not running analyses for other projects) before you re-run this command.</p>
</div>
<p>If most of your analyses finished successfully, the script will seem like
it’s running slow.
Just be patient; it is checking the output of all the analyses, and only writes
a message to the screen if it finds an analysis that didn’t finish
successfully.
So, if it seems like nothing is happening, that’s a good thing (i.e., the
script is finding lots of successfully completed analyses).
Here is my output from the <code class="docutils literal notranslate"><span class="pre">submit_sim_analyses.sh</span></code> script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Beginning</span> <span class="n">to</span> <span class="n">vet</span> <span class="ow">and</span> <span class="n">consolidate</span> <span class="n">sim</span> <span class="n">analysis</span> <span class="n">files</span> <span class="ow">in</span><span class="p">:</span>
  <span class="s1">&#39;../ecoevolity-simulations/fixed-pairs-10-independent-time-1_0-0_05/batch-308303035&#39;</span>
<span class="n">Incomplete</span> <span class="n">stdout</span><span class="p">:</span> <span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="n">jro0014</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">prior</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/</span><span class="n">fixed</span><span class="o">-</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">independent</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span><span class="o">/</span><span class="n">var</span><span class="o">-</span><span class="n">only</span><span class="o">-</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">dpp</span><span class="o">-</span><span class="n">conc</span><span class="o">-</span><span class="mi">2_0</span><span class="o">-</span><span class="mi">2_71</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">-</span><span class="n">sim</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="n">qsub</span><span class="o">.</span><span class="n">sh</span>
<span class="n">Incomplete</span> <span class="n">stdout</span><span class="p">:</span> <span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="n">jro0014</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">prior</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/</span><span class="n">fixed</span><span class="o">-</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">independent</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span><span class="o">/</span><span class="n">var</span><span class="o">-</span><span class="n">only</span><span class="o">-</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">dpp</span><span class="o">-</span><span class="n">conc</span><span class="o">-</span><span class="mi">2_0</span><span class="o">-</span><span class="mi">2_71</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">-</span><span class="n">sim</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">qsub</span><span class="o">.</span><span class="n">sh</span>
<span class="n">Incomplete</span> <span class="n">stdout</span><span class="p">:</span> <span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="n">jro0014</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">prior</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/</span><span class="n">fixed</span><span class="o">-</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">independent</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span><span class="o">/</span><span class="n">var</span><span class="o">-</span><span class="n">only</span><span class="o">-</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">dpp</span><span class="o">-</span><span class="n">conc</span><span class="o">-</span><span class="mi">2_0</span><span class="o">-</span><span class="mi">2_71</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">-</span><span class="n">sim</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">qsub</span><span class="o">.</span><span class="n">sh</span>
<span class="n">Incomplete</span> <span class="n">stdout</span><span class="p">:</span> <span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="n">jro0014</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">prior</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/</span><span class="n">fixed</span><span class="o">-</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">independent</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span><span class="o">/</span><span class="n">var</span><span class="o">-</span><span class="n">only</span><span class="o">-</span><span class="n">pairs</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="n">dpp</span><span class="o">-</span><span class="n">conc</span><span class="o">-</span><span class="mi">2_0</span><span class="o">-</span><span class="mi">2_71</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="mi">1_0</span><span class="o">-</span><span class="mi">0_05</span><span class="o">-</span><span class="n">sim</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">qsub</span><span class="o">.</span><span class="n">sh</span>
<span class="n">Beginning</span> <span class="n">to</span> <span class="n">vet</span> <span class="ow">and</span> <span class="n">consolidate</span> <span class="n">sim</span> <span class="n">analysis</span> <span class="n">files</span> <span class="ow">in</span><span class="p">:</span>
  <span class="s1">&#39;../ecoevolity-simulations/fixed-pairs-10-simultaneous-time-1_0-0_05/batch-308303035&#39;</span>
<span class="n">Beginning</span> <span class="n">to</span> <span class="n">vet</span> <span class="ow">and</span> <span class="n">consolidate</span> <span class="n">sim</span> <span class="n">analysis</span> <span class="n">files</span> <span class="ow">in</span><span class="p">:</span>
  <span class="s1">&#39;../ecoevolity-simulations/pairs-10-dpp-conc-2_0-2_71-time-1_0-0_05/batch-308303035&#39;</span>
<span class="n">Beginning</span> <span class="n">to</span> <span class="n">vet</span> <span class="ow">and</span> <span class="n">consolidate</span> <span class="n">sim</span> <span class="n">analysis</span> <span class="n">files</span> <span class="ow">in</span><span class="p">:</span>
  <span class="s1">&#39;../ecoevolity-simulations/pairs-10-pyp-conc-2_0-1_79-disc-1_0-4_0-time-1_0-0_05/batch-308303035&#39;</span>
<span class="n">Beginning</span> <span class="n">to</span> <span class="n">vet</span> <span class="ow">and</span> <span class="n">consolidate</span> <span class="n">sim</span> <span class="n">analysis</span> <span class="n">files</span> <span class="ow">in</span><span class="p">:</span>
  <span class="s1">&#39;../ecoevolity-simulations/pairs-10-unif-sw-0_55-7_32-time-1_0-0_05/batch-308303035&#39;</span>
<span class="n">Submitting</span> <span class="n">analyses</span> <span class="n">to</span> <span class="n">queue</span><span class="o">...</span>
<span class="o">../</span><span class="nb">bin</span><span class="o">/</span><span class="n">psub</span> <span class="o">-</span><span class="n">t</span> <span class="mi">00</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="n">a</span> <span class="mi">1</span><span class="o">-</span><span class="mi">4</span> <span class="o">../</span><span class="nb">bin</span><span class="o">/</span><span class="n">spawn_job_array</span> <span class="o">/</span><span class="n">scratch</span><span class="o">/</span><span class="n">jro0014</span><span class="o">/</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">prior</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">spawn_job_array</span><span class="o">.</span><span class="n">QmIIkUO2GxMY</span>
<span class="n">qsub</span> <span class="o">-</span><span class="n">q</span> <span class="n">general</span> <span class="o">-</span><span class="n">j</span> <span class="n">oe</span> <span class="o">-</span><span class="n">l</span> <span class="n">nodes</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">ppn</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">walltime</span><span class="o">=</span><span class="mi">00</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="n">t</span> <span class="mi">1</span><span class="o">-</span><span class="mi">4</span> <span class="o">../</span><span class="nb">bin</span><span class="o">/</span><span class="n">spawn_job_array</span> <span class="o">-</span><span class="n">F</span>  <span class="s2">&quot;/scratch/jro0014/ecoevolity-model-prior/scripts/spawn_job_array.QmIIkUO2GxMY&quot;</span>
<span class="mi">1942363</span><span class="p">[]</span><span class="o">.</span><span class="n">hopper</span><span class="o">-</span><span class="n">mgt</span>
</pre></div>
</div>
<p>This output is telling me that four of the analyses (of the 1200 I submitted
the first time) did not finish (their standard output was incomplete).
The output also confirms that these failed analyses are being re-run via a new
job array.
Again, you can monitor the progress of your re-analyses using <code class="docutils literal notranslate"><span class="pre">qstat</span> <span class="pre">-t</span></code>,
and once they finish, go ahead and run the following command for the
third time (from within the <code class="docutils literal notranslate"><span class="pre">scripts</span></code> directory):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="n">submit_sim_analyses</span><span class="o">.</span><span class="n">sh</span> <span class="o">../</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/*/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span>
</pre></div>
</div>
<p>Hopefully the third time, your output will look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Beginning to vet and consolidate sim analysis files in:
  &#39;../ecoevolity-simulations/fixed-pairs-10-independent-time-1_0-0_05/batch-308303035&#39;
Beginning to vet and consolidate sim analysis files in:
  &#39;../ecoevolity-simulations/fixed-pairs-10-simultaneous-time-1_0-0_05/batch-308303035&#39;
Beginning to vet and consolidate sim analysis files in:
  &#39;../ecoevolity-simulations/pairs-10-dpp-conc-2_0-2_71-time-1_0-0_05/batch-308303035&#39;
Beginning to vet and consolidate sim analysis files in:
  &#39;../ecoevolity-simulations/pairs-10-pyp-conc-2_0-1_79-disc-1_0-4_0-time-1_0-0_05/batch-308303035&#39;
Beginning to vet and consolidate sim analysis files in:
  &#39;../ecoevolity-simulations/pairs-10-unif-sw-0_55-7_32-time-1_0-0_05/batch-308303035&#39;
All analyses are complete and clean!
</pre></div>
</div>
<p>This confirms that all of your analyses have successfully finished!
Note, the job failure rate of the Hopper cluster
fluctuates.
So, you might have had some failures that got resubmitted during your third use
of <code class="docutils literal notranslate"><span class="pre">submit_sim_analyses.sh</span></code> above.
If so, just monitor those re-runs with <code class="docutils literal notranslate"><span class="pre">qstat</span> <span class="pre">-t</span></code>, and run the
<code class="docutils literal notranslate"><span class="pre">submit_sim_analyses.sh</span></code> script again after they finished (as we did three
times above).
Eventually, you should get the <code class="docutils literal notranslate"><span class="pre">All</span> <span class="pre">analyses</span> <span class="pre">are</span> <span class="pre">complete</span> <span class="pre">and</span> <span class="pre">clean!</span></code>
message.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Analyses that get need to be re-run are done so exactly (i.e., the
exact same data and starting seed for the random number generator).</p>
<p>These jobs are not failing due to any issues with <a class="reference external" href="http://phyletica.org/ecoevolity">ecoevolity</a>.
Our cluster almost always has some small failure rate when running lots of
jobs, no matter how simple the jobs are.
So, we can simply run them again, exactly as before, and they will work
fine.</p>
<p class="last">I say this, because if we were re-running analyses with different simulated
datasets or different starting seeds, we could be creating subtle biases in
our analyses.
That is not the case here.
We are only re-running analyses because our cluster’s queue/scheduler
system is … less than ideal.</p>
</div>
<p>Go ahead and clean out all the output files from the job array from inside the
<code class="docutils literal notranslate"><span class="pre">scripts</span></code> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="n">spawn_job_array</span><span class="o">.*</span>
</pre></div>
</div>
</div>
<div class="section" id="summarizing-the-results">
<h2>Summarizing the results<a class="headerlink" href="#summarizing-the-results" title="Permalink to this headline">¶</a></h2>
<p>After the
<code class="docutils literal notranslate"><span class="pre">submit_sim_analyses.sh</span></code> script confirms that <code class="docutils literal notranslate"><span class="pre">All</span> <span class="pre">analyses</span> <span class="pre">are</span> <span class="pre">complete</span>
<span class="pre">and</span> <span class="pre">clean!</span></code>
it is time for us to summarize the results from all 1200 analyses we ran.
Our results are currently scattered across 1200 log files output by
<code class="docutils literal notranslate"><span class="pre">ecoevolity</span></code> during these analyses.
These log files contain MCMC samples collected from the posterior distribution
of the respective model given the simulated dataset.
We will use the Python script <code class="docutils literal notranslate"><span class="pre">scripts/parse_sim_results.py</span></code> to parse all
these log files (posterior samples) and summarize them in tab-delimited tables.
We will run the <code class="docutils literal notranslate"><span class="pre">parse_sim_results.py</span></code> Python script using the
<code class="docutils literal notranslate"><span class="pre">parse_sim_results.sh</span></code> Bash script, so that we can submit it as a job to the
queue.
Assuming you are on the Hopper cluster and in the <code class="docutils literal notranslate"><span class="pre">scripts</span></code> directory of your
copy of the project, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">../</span><span class="nb">bin</span><span class="o">/</span><span class="n">psub</span> <span class="n">parse_sim_results</span><span class="o">.</span><span class="n">sh</span> <span class="o">../</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/*/*</span><span class="mi">308303035</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you are not on the Hopper cluster, you can simply run the Python
script directly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">parse_sim_results</span><span class="o">.</span><span class="n">py</span> <span class="o">../</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/*/*</span><span class="mi">308303035</span>
</pre></div>
</div>
<p class="last">Just make sure you have the <code class="docutils literal notranslate"><span class="pre">ecoevolity-model-prior-project</span></code> conda
environment activated.</p>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">qstat</span></code> command to monitor the progress of the job.
Once the output of <code class="docutils literal notranslate"><span class="pre">qstat</span></code> confirms the script has finished running,
we can take a look at all the tab-delimited text files it created
that summarize all the results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ls</span> <span class="o">../</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/*/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span><span class="o">/*</span><span class="n">results</span><span class="o">.</span><span class="n">tsv</span>
</pre></div>
</div>
<p>You will notice that each <code class="docutils literal notranslate"><span class="pre">batch</span></code> directory of simulations has 6 files that
end with “results.tsv”.
Each one contains the summarized results for one of the three models (DP, PYP,
or SW) while using or ignoring the constant characters.
Each line of these files summarizes the results for one of the simulation
replicates.
So each of these files should have 11 lines (10 lines of results, plus a line
with the column headers).
We can easily confirm this using <code class="docutils literal notranslate"><span class="pre">wc</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wc</span> <span class="o">-</span><span class="n">l</span> <span class="o">../</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/*/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span><span class="o">/*</span><span class="n">results</span><span class="o">.</span><span class="n">tsv</span>
</pre></div>
</div>
<p>Now, let’s <code class="docutils literal notranslate"><span class="pre">gzip</span></code> these files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gzip</span> <span class="o">../</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/*/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span><span class="o">/*</span><span class="n">results</span><span class="o">.</span><span class="n">tsv</span>
</pre></div>
</div>
<p>Now, add them to the staging area of the project Git repository:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">add</span> <span class="o">../</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/*/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span><span class="o">/*</span><span class="n">results</span><span class="o">.</span><span class="n">tsv</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
<p>And, commit them to the repository database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">commit</span>
</pre></div>
</div>
<p>A good commit message might look something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Adding</span> <span class="n">batch</span> <span class="mi">308303035</span> <span class="n">of</span> <span class="n">simulation</span> <span class="n">results</span><span class="o">.</span>

<span class="n">Adding</span> <span class="n">gzipped</span><span class="p">,</span> <span class="n">tab</span><span class="o">-</span><span class="n">delimited</span> <span class="n">files</span><span class="o">.</span> <span class="n">Each</span> <span class="n">file</span> <span class="n">summarizes</span> <span class="n">the</span>
<span class="n">results</span> <span class="n">of</span> <span class="n">ecoevolity</span> <span class="n">analyses</span> <span class="n">of</span> <span class="mi">10</span> <span class="n">simcoevolity</span> <span class="n">simulation</span>
<span class="n">replicates</span><span class="o">.</span> <span class="n">Adding</span> <span class="n">these</span> <span class="n">files</span> <span class="k">for</span> <span class="n">simulations</span> <span class="n">under</span> <span class="mi">5</span> <span class="n">models</span>
<span class="n">analysed</span> <span class="k">with</span> <span class="mi">3</span> <span class="n">models</span><span class="p">,</span> <span class="k">with</span> <span class="ow">and</span> <span class="n">without</span> <span class="n">constant</span> <span class="n">characters</span><span class="o">.</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Git handles the versioning of text files very well, but not zipped
files. So, we usually want to avoid adding zipped files to a Git
repository. If we have large files we want to keep in a Git repo, it’s
better to use an extension like <a class="reference external" href="https://git-lfs.github.com/">Git LFS</a>.</p>
<p class="last">However, in this case we are adding files that we never want to version
control (we shouldn’t be editing our results files!). So, it is not a
problem that Git will not be able to track line-by-line changes to these
files.</p>
</div>
<p>Finally, push your new results to the remote repository hosted on a <a class="reference external" href="https://github.com/">GitHub</a>
server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">push</span> <span class="n">origin</span> <span class="n">master</span>
</pre></div>
</div>
</div>
<div class="section" id="cleaning-up">
<h2>Cleaning up<a class="headerlink" href="#cleaning-up" title="Permalink to this headline">¶</a></h2>
<p>After we have committed and pushed the results of our analyses, let’s cleanup
all those thousands of files that were generated during the simulations and
analyses:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="n">archive_sim_files</span><span class="o">.</span><span class="n">sh</span> <span class="o">../</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/*/*</span><span class="mi">308303035</span>
</pre></div>
</div>
<p>This script will copy these files into compressed archives and remove the
original files.</p>
<p>Now, we can add these archives to the git repository:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">add</span> <span class="o">../</span><span class="n">ecoevolity</span><span class="o">-</span><span class="n">simulations</span><span class="o">/*/</span><span class="n">batch</span><span class="o">-</span><span class="mi">308303035</span><span class="o">/*.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
<p>And, commit them to the repository database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">commit</span>
</pre></div>
</div>
<p>A good commit message might look something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Adding archives of sim files for batch 308303035.

Adding compressed archives of all the ``simcoevolity`` and
``ecoevolity`` files for batch 308303035 of simulation replicates.
These files are handled by Git LFS, so only a reference to the
files is stored in the git database.
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>As discussed above, Git handles the versioning of text files very
well, but not large, compressed files like the ones we just added.
So, why did we add them? Well, we have configured
<a class="reference external" href="https://git-lfs.github.com/">Git LFS</a>.
to handle any files that end with “<code class="docutils literal notranslate"><span class="pre">.tar.gz</span></code>” (this configuration is in
the <code class="docutils literal notranslate"><span class="pre">.gitattributes</span></code> file in the base directory of the project).</p>
<p class="last">Git LFS works by only storing references to these files, rather than the
files themselves. So, <code class="docutils literal notranslate"><span class="pre">git</span></code> doesn’t track the contents of these large,
compressed files. Which is good for us; we aren’t going to be making
edits to these files!</p>
</div>
<p>Finally, push everything to the remote repository on <a class="reference external" href="https://github.com/">GitHub</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">push</span> <span class="n">origin</span> <span class="n">master</span>
</pre></div>
</div>
</div>
<div class="section" id="reflection">
<h2>Reflection<a class="headerlink" href="#reflection" title="Permalink to this headline">¶</a></h2>
<p>That’s it!
You’ve just contributed a batch of simulation-based analyses to this project.
Take a moment to reflect on what you did and why
(the <a class="reference internal" href="background.html#background"><span class="std std-ref">Background</span></a> and <a class="reference internal" href="ecoevolity-configs.html#eco-configs"><span class="std std-ref">The ecoevolity configs</span></a> sections might help for this).
Can you think of other models or simulation conditions that would be good to
explore for this project?</p>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
<div class="footer" role="contentinfo" align="center">
    <a href="https://github.com/phyletica/ecoevolity-model-prior">GitHub</a> &nbsp; | &nbsp; <a href="license.html">License</a> &nbsp; | &nbsp; <a href="citation.html">Citation</a> &nbsp; | &nbsp; <a href="https://groups.google.com/forum/#!forum/ecoevolity-users">User's Forum</a>
</div>

  </body>
</html>